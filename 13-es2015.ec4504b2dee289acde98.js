(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{LxFr:function(e,t,s){"use strict";s.r(t),s.d(t,"ShopsModule",(function(){return re}));var o=s("ofXK"),i=s("3Pt+"),r=s("ZZCA"),n=s("Lm2G"),a=s("tyNb"),c=s("0Tvr"),b=s("fXoL"),l=s("4Q0Y"),h=s("BCCV");function d(e,t){1&e&&(b.Yb(0,"mdb-error"),b.Mc(1,"Enter shop name to search"),b.Xb())}function p(e,t){1&e&&(b.Yb(0,"div",21),b.Yb(1,"div",22),b.Tb(2,"div",23),b.Xb(),b.Xb())}function u(e,t){if(1&e){const e=b.Zb();b.Yb(0,"tr"),b.Yb(1,"td"),b.Mc(2),b.Xb(),b.Yb(3,"td"),b.Mc(4),b.Xb(),b.Yb(5,"td"),b.Mc(6),b.Xb(),b.Yb(7,"td"),b.Mc(8),b.Xb(),b.Yb(9,"td"),b.Tb(10,"mdb-checkbox",24),b.Xb(),b.Yb(11,"td"),b.Yb(12,"button",25),b.gc("click",(function(){b.Ec(e);const s=t.$implicit;return b.kc().viewShop(s)})),b.Mc(13,"View"),b.Xb(),b.Xb(),b.Xb()}if(2&e){const e=t.$implicit,s=t.index,o=b.kc();b.Db(2),b.Oc("",o.itemNumber(s),"."),b.Db(2),b.Nc(e.shop_name),b.Db(2),b.Nc(e.phone_number),b.Db(2),b.Nc(e.shop_location),b.Db(2),b.qc("checked",e.is_open)("disabled",!0)}}let m=(()=>{class e{constructor(e,t,s,o,i,r){this._formBuilder=e,this._userService=t,this._shopService=s,this._router=o,this._route=i,this._modalService=r,this.page=new c.a,this.MAX_SIZE=3,this.shopsList=[]}ngOnInit(){this.user=this._userService.getAuthenticatedUser(),this.page.pageNumber=0,this.searchName="",this.searchForm=this._formBuilder.group({shop_name:["",i.s.compose([i.s.required])]}),this.searchForm.get("shop_name").valueChanges.pipe().subscribe(e=>{this.page.pageNumber=0,this.page_changed=!1,this.searchForm.valid?(this.loading=!0,this.searchName=e,this.getShops()):(this.searchName="",this.getShops())}),this.getShops()}isTouched(e){return this.searchForm.controls[e].touched}isInValid(e,t){return this.searchForm.controls[e].hasError(t)}get isInvalidShopName(){return this.isInValid("shop_name","required")&&this.isTouched("shop_name")}itemNumber(e){return this.page_changed?(this.page.pageNumber-1)*this.page.size+e+1:e+1}pageChanged(e){this.page.pageNumber=e.page,this.page_changed=!0,this.getShops()}getShops(){this.loading=!0,this.shopsList=[],this._shopService.getShops(this.page.pageNumber.toString(),this.page.size.toString(),this.user.id.toString(),null,this.searchName).subscribe(e=>{console.log(e),this.page.totalElements=e.meta.total_elements,this.page.totalPages=e.meta.total_elements>0?Math.ceil(e.meta.total_elements/this.page.size):0,this.shopsList=e.data,this.loading=!1},e=>{this.loading=!1})}viewShop(e){this._router.navigate([e.shop_number],{relativeTo:this._route})}addShop(){this._router.navigate(["add"],{relativeTo:this._route})}}return e.\u0275fac=function(t){return new(t||e)(b.Sb(i.c),b.Sb(l.a),b.Sb(h.a),b.Sb(a.e),b.Sb(a.a),b.Sb(r.u))},e.\u0275cmp=b.Mb({type:e,selectors:[["app-shops"]],decls:43,vars:8,consts:[[1,"drop_content"],[1,"row"],[1,"col-md-12","mb-4",2,"padding-top","5px"],[1,"card"],[1,"card-body","border-top"],[1,"col-md-12","col-lg-12","col-sm-12","mb-2"],[3,"formGroup"],[1,"col-sm-4","offset-sm-4"],[1,"md-form","text-center","mr-2","pr-1"],["id","shop_name","type","text","mdbInput","","mdbValidate","","formControlName","shop_name",1,"form-control"],["for","shop_name"],[4,"ngIf"],[1,"col-sm-4"],[1,"float-right","btn","btn-primary","btn-sm",3,"click"],["class","col-md-12 col-lg-12 col-sm-6 overlay",4,"ngIf"],[1,"col-md-12","col-sm-12","col-sm-6"],[1,"table-responsive"],[1,"table","table-bordered","table-hover"],["scope","col"],[4,"ngFor","ngForOf"],[1,"float-left","drop_table_pagenation",3,"maxSize","totalItems","ngModel","itemsPerPage","ngModelChange","pageChanged"],[1,"col-md-12","col-lg-12","col-sm-6","overlay"],[1,"spinner-wrapper"],[1,"spinner"],[3,"checked","disabled"],[1,"btn","btn-primary","btn-sm","mr-2",2,"cursor","pointer",3,"click"]],template:function(e,t){1&e&&(b.Yb(0,"div",0),b.Yb(1,"div",1),b.Yb(2,"div",2),b.Yb(3,"div",3),b.Yb(4,"div",4),b.Yb(5,"div",1),b.Yb(6,"div",5),b.Yb(7,"form",6),b.Yb(8,"div",1),b.Yb(9,"div",7),b.Yb(10,"div",8),b.Tb(11,"input",9),b.Yb(12,"label",10),b.Mc(13,"Search by shop name"),b.Xb(),b.Kc(14,d,2,0,"mdb-error",11),b.Xb(),b.Xb(),b.Yb(15,"div",12),b.Yb(16,"div",8),b.Yb(17,"span",13),b.gc("click",(function(){return t.addShop()})),b.Mc(18,"Add Shop"),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Yb(19,"div",1),b.Kc(20,p,3,0,"div",14),b.Xb(),b.Yb(21,"div",15),b.Yb(22,"div",16),b.Yb(23,"table",17),b.Yb(24,"caption"),b.Mc(25,"List of Shops"),b.Xb(),b.Yb(26,"thead"),b.Yb(27,"tr"),b.Yb(28,"th",18),b.Mc(29,"#"),b.Xb(),b.Yb(30,"th",18),b.Mc(31,"Name"),b.Xb(),b.Yb(32,"th",18),b.Mc(33,"Contact"),b.Xb(),b.Yb(34,"th",18),b.Mc(35,"Location"),b.Xb(),b.Yb(36,"th",18),b.Mc(37,"Is Open"),b.Xb(),b.Yb(38,"th",18),b.Mc(39,"Action"),b.Xb(),b.Xb(),b.Xb(),b.Yb(40,"tbody"),b.Kc(41,u,14,6,"tr",19),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Yb(42,"pagination",20),b.gc("ngModelChange",(function(e){return t.page.pageNumber=e}))("pageChanged",(function(e){return t.pageChanged(e)})),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb()),2&e&&(b.Db(7),b.qc("formGroup",t.searchForm),b.Db(7),b.qc("ngIf",t.isInvalidShopName),b.Db(6),b.qc("ngIf",t.loading),b.Db(21),b.qc("ngForOf",t.shopsList),b.Db(1),b.qc("maxSize",t.MAX_SIZE)("totalItems",t.page.totalElements)("ngModel",t.page.pageNumber)("itemsPerPage",t.page.size))},directives:[i.u,i.l,i.f,i.b,r.C,r.G,i.k,i.e,o.j,o.i,n.a,i.m,r.A,r.i],styles:[".card-body[_ngcontent-%COMP%]{padding-top:0;padding-right:0;padding-left:0}.md-form[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:.75rem}"]}),e})();class g{}class X{constructor(){this.new_dropping=0,this.accepted_items=0,this.release_requests=0,this.total_earning=0,this.shop_earning=0,this.drop_earning=0,this.weekly_accepted_items=0,this.weekly_release_requests=0,this.weekly_unpicked_requests=0,this.Weekly_total_earning=0,this.Weekly_shop_earning=0,this.Weekly_drop_earning=0,this.weekly_stats=[],this.stored_items=0}}var Y=s("lSn3"),_=s("SJ6J"),f=s("P6yk");function v(e,t){1&e&&(b.Yb(0,"div",41),b.Yb(1,"div",42),b.Tb(2,"div",43),b.Xb(),b.Xb())}function S(e,t){if(1&e){const e=b.Zb();b.Yb(0,"a",44),b.gc("click",(function(){return b.Ec(e),b.kc().openShopUsers()})),b.Tb(1,"i",45),b.Mc(2," Users "),b.Xb()}}function M(e,t){if(1&e){const e=b.Zb();b.Yb(0,"a",46),b.gc("click",(function(){return b.Ec(e),b.kc().openShopProfile()})),b.Tb(1,"i",47),b.Mc(2," Shop Profile "),b.Xb()}}function k(e,t){if(1&e){const e=b.Zb();b.Yb(0,"a",55),b.gc("click",(function(){b.Ec(e);const t=b.kc(2).$implicit;return b.kc().acceptDeclineItem("accept",t)})),b.Mc(1,"Accept"),b.Xb()}}function D(e,t){if(1&e){const e=b.Zb();b.Yb(0,"a",55),b.gc("click",(function(){b.Ec(e);const t=b.kc(2).$implicit;return b.kc().acceptDeclineItem("decline",t)})),b.Mc(1,"Decline"),b.Xb()}}function N(e,t){if(1&e){const e=b.Zb();b.Yb(0,"a",55),b.gc("click",(function(){b.Ec(e);const t=b.kc(2).$implicit;return b.kc().acceptDeclineItem("release",t)})),b.Mc(1,"Release"),b.Xb()}}function y(e,t){if(1&e&&(b.Yb(0,"div",50),b.Yb(1,"a",51),b.Tb(2,"i",52),b.Xb(),b.Yb(3,"div",53),b.Kc(4,k,2,0,"a",54),b.Kc(5,D,2,0,"a",54),b.Kc(6,N,2,0,"a",54),b.Xb(),b.Xb()),2&e){const e=b.kc().$implicit;b.Db(4),b.qc("ngIf",1===e.status.id),b.Db(1),b.qc("ngIf",1===e.status.id),b.Db(1),b.qc("ngIf",3===e.status.id)}}function w(e,t){if(1&e&&(b.Yb(0,"tr"),b.Yb(1,"td"),b.Mc(2),b.Xb(),b.Yb(3,"td"),b.Mc(4),b.Xb(),b.Yb(5,"td"),b.Mc(6),b.Xb(),b.Yb(7,"td"),b.Mc(8),b.Xb(),b.Yb(9,"td"),b.Mc(10),b.Xb(),b.Yb(11,"td"),b.Mc(12),b.Xb(),b.Yb(13,"td"),b.Mc(14),b.Xb(),b.Yb(15,"td"),b.Mc(16),b.Xb(),b.Yb(17,"td"),b.Mc(18),b.Xb(),b.Yb(19,"td",48),b.Kc(20,y,7,3,"div",49),b.Xb(),b.Xb()),2&e){const e=t.$implicit,s=t.index,o=b.kc();b.Db(2),b.Oc("",o.itemNumber(s),"."),b.Db(2),b.Nc(e.item_name),b.Db(2),b.Nc(e.item_description),b.Db(2),b.Nc(e.item_type),b.Db(2),b.Nc(e.hours_stored),b.Db(2),b.Nc(e.total_cost),b.Db(2),b.Nc(e.total_cost_paid),b.Db(2),b.Nc(e.total_cost_unpaid),b.Db(2),b.Nc(e.status.name),b.Db(2),b.qc("ngIf",1===e.status.id||3===e.status.id)}}function C(e,t){if(1&e){const e=b.Zb();b.Yb(0,"tr"),b.Yb(1,"td"),b.Mc(2),b.Xb(),b.Yb(3,"td"),b.Mc(4),b.Xb(),b.Yb(5,"td"),b.Mc(6),b.Xb(),b.Yb(7,"td"),b.Mc(8),b.Xb(),b.Yb(9,"td"),b.Tb(10,"mdb-checkbox",58),b.Xb(),b.Yb(11,"td",48),b.Yb(12,"button",59),b.gc("click",(function(){b.Ec(e);const s=t.$implicit;return b.kc(2).viewUser(s)})),b.Mc(13,"View"),b.Xb(),b.Xb(),b.Xb()}if(2&e){const e=t.$implicit,s=t.index,o=b.kc(2);b.Db(2),b.Oc("",o.itemNumber(s),"."),b.Db(2),b.Nc(e.first_name+" "+e.last_name),b.Db(2),b.Nc(e.email_address),b.Db(2),b.Nc(e.phone_number),b.Db(2),b.qc("checked",e.enabled)("disabled",!0)}}function I(e,t){if(1&e){const e=b.Zb();b.Yb(0,"div",1),b.Yb(1,"div",19),b.Yb(2,"div",20),b.Yb(3,"h2"),b.Mc(4,"Shop "),b.Yb(5,"small"),b.Mc(6,"Operators"),b.Xb(),b.Xb(),b.Yb(7,"div",26),b.Yb(8,"div",34),b.Yb(9,"div",35),b.Yb(10,"table",56),b.Yb(11,"caption"),b.Mc(12,"List of Shop Operators"),b.Xb(),b.Yb(13,"thead"),b.Yb(14,"tr"),b.Yb(15,"th",37),b.Mc(16,"#"),b.Xb(),b.Yb(17,"th",37),b.Mc(18,"Name"),b.Xb(),b.Yb(19,"th",37),b.Mc(20,"Email"),b.Xb(),b.Yb(21,"th",37),b.Mc(22,"Phone"),b.Xb(),b.Yb(23,"th",37),b.Mc(24,"Active"),b.Xb(),b.Yb(25,"th",57),b.Mc(26,"Action"),b.Xb(),b.Xb(),b.Xb(),b.Yb(27,"tbody"),b.Kc(28,C,14,6,"tr",38),b.Xb(),b.Xb(),b.Yb(29,"a",39),b.gc("click",(function(){return b.Ec(e),b.kc().openShopUsers()})),b.Mc(30,"View All"),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb()}if(2&e){const e=b.kc();b.Db(28),b.qc("ngForOf",e.userList)}}let O=(()=>{class e{constructor(e,t,s,o,i,r,n){this._formBuilder=e,this._dropService=t,this._shopService=s,this._userService=o,this._router=i,this._route=r,this._modalService=n,this.today=new Date,this.page=new c.a,this.shop=new g,this.dropShopStats=new X,this.itemList=[],this.userList=[],this.chartType="line",this.chartDatasets=[{data:[0,0,0,0,0,0,0],label:"Drop Requests Handled"}],this.chartLabels=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],this.chartColors=[{backgroundColor:"rgba(0, 137, 132, .2)",borderColor:"rgba(0, 10, 130, .7)",borderWidth:2}],this.chartOptions={responsive:!0,scales:{yAxes:[{ticks:{beginAtZero:!0}}]}},this.pickDateOptions={dateFormat:"yyyy-mm-dd",firstDayOfWeek:"mo",maxYear:this.today.getFullYear(),disableSince:{year:this.today.getFullYear(),month:this.today.getMonth()+1,day:this.today.getDate()+1}}}ngOnInit(){this.shopNumber=window.location.pathname.split("/").pop(),this.user=this._userService.getAuthenticatedUser(),null==this.shopNumber&&null==this.shopNumber||(this.shop=Object(Y.h)(this.user.shops,this.shopNumber),this.hasShopAdminRole=null!=this.shop&&null!=this.shop&&Object(Y.i)(this.user.roles,3,this.shop.id),this.getShop()),this.dateFilterForm=this._formBuilder.group({pick_date:""}),this.dateFilterForm.controls.pick_date.setValue(this.today),this.dateFilterForm.get("pick_date").valueChanges.subscribe(e=>{this.loading=!0,this.getShopDropStats(),this.loading=!1}),null==this.shopNumber||null==this.shopNumber?this._router.navigate(["/drop/shops"]):this.getShopDetails(),this._modalService.closed.subscribe(()=>this.getShopDetails())}getShopDetails(){this.loading=!0,this._userService.getUsers(this.page.pageNumber.toString(),"1",this.user.id.toString(),null,this.shopNumber,null,null,null).subscribe(e=>{this.user=e.data[0],this.shop=Object(Y.h)(this.user.shops,this.shopNumber),this.hasShopAdminRole=Object(Y.i)(this.user.roles,3,this.shop.id),this.getShop(),this.loading=!1},e=>{this.loading=!1})}getShop(){this._shopService.getShops(this.page.pageNumber.toString(),"1",null,null,null,this.shopNumber).subscribe(e=>{this.shop=e.data[0],this.getShopDropStats(),this.getItems(),this.getShopUsers()},e=>{})}getItems(){this.page.size=5,this.itemList=[],this._dropService.getItems(this.page.pageNumber.toString(),this.page.size.toString(),null,this.shop.id.toString(),null,null,null,this.shopNumber).subscribe(e=>{this.itemList=e.data},e=>{})}getShopUsers(){this.page.size=5,this.userList=[],this._userService.getUsers(this.page.pageNumber.toString(),this.page.size.toString(),null,this.shop.id.toString(),this.shopNumber,null,null,null).subscribe(e=>{this.userList=e.data},e=>{})}getShopDropStats(){let e=new Date(this.dateFilterForm.get("pick_date").value).toISOString();this._dropService.getDropStats(this.shop.id.toString(),this.shopNumber,e).subscribe(e=>{this.dropShopStats=e.data,this.dropShopStats.stored_items=e.data.accepted_items+e.data.release_requests;let t=[];this.dropShopStats.weekly_stats.forEach(e=>{t.push(e.drop_count)}),this.chartDatasets=[{data:t,label:"Drop Requests Handled"}]},e=>{})}itemNumber(e){return e+1}chartClicked(e){}chartHovered(e){}openRequests(e){this._dropService.setItemStatus(null!=e&&Object(Y.c)(e).validNumeric?e:""),this._router.navigate(["items"],{relativeTo:this._route})}openShopUsers(){this._router.navigate(["users"],{relativeTo:this._route})}openShopProfile(){this._router.navigate(["profile"],{relativeTo:this._route})}viewUser(e){this._router.navigate(["users/"+e.user_number],{relativeTo:this._route})}acceptDeclineItem(e,t){this.modalRef=this._modalService.show(_.a,{backdrop:!0,ignoreBackdropClick:!0,class:"modal-md cascading-modal",data:{action:e,item:t}})}}return e.\u0275fac=function(t){return new(t||e)(b.Sb(i.c),b.Sb(f.a),b.Sb(h.a),b.Sb(l.a),b.Sb(a.e),b.Sb(a.a),b.Sb(r.u))},e.\u0275cmp=b.Mb({type:e,selectors:[["app-shop"]],decls:150,vars:30,consts:[[1,"drop_content"],[1,"row"],[1,"col-md-12","mb-4",2,"padding-top","5px"],[1,"card"],[1,"card-body","border-top"],["class","col-md-12 col-lg-12 col-sm-6 overlay",4,"ngIf"],[1,"row","justify-content-between","mb-2"],[1,"col-md-4"],[1,"col-md-5","offset-md-3","text-right","mr-0"],["rounded","true","mdbBtn","","mdbWavesEffect","",1,"btn","btn-sm","btn-danger",3,"click"],[1,"fa","fa-tint"],["class","btn btn-sm btn-info","rounded","true","mdbBtn","","mdbWavesEffect","",3,"click",4,"ngIf"],["class","btn btn-sm btn-secondary","rounded","true","mdbBtn","","mdbWavesEffect","",3,"click",4,"ngIf"],[1,"row","top_tiles"],[1,"animated","flipInY","col-lg-3","col-md-3","col-sm-6","col-xs-12"],["mdbWavesEffect","",1,"tile-stats",3,"click"],[1,"icon"],[1,"count"],[1,"tile-stats"],[1,"col-md-12"],[1,"x_panel"],[1,"x_title"],[1,"col-md-3","offset-sm-4"],[3,"formGroup"],[1,"md-form"],["name","pick_date","formControlName","pick_date",3,"inline","options"],[1,"x_content"],[1,"col-md-9","col-sm-12","col-xs-12"],[2,"display","block"],["mdbChart","",3,"chartType","datasets","labels","colors","options","legend","chartHover","chartClick"],["chart",""],[1,"col-md-3","col-sm-12","col-xs-12"],[1,"animated","flipInY","col-lg-12","col-md-12","col-sm-12","col-xs-12"],[1,"tile-stats","card"],[1,"col-md-12","com-sm-12","col-xs-12"],[1,"table-responsive"],[1,"table","table-hover"],["scope","col"],[4,"ngFor","ngForOf"],[1,"text-primary","float-right",3,"click"],["class","row",4,"ngIf"],[1,"col-md-12","col-lg-12","col-sm-6","overlay"],[1,"spinner-wrapper"],[1,"spinner"],["rounded","true","mdbBtn","","mdbWavesEffect","",1,"btn","btn-sm","btn-info",3,"click"],[1,"fa","fa-users"],["rounded","true","mdbBtn","","mdbWavesEffect","",1,"btn","btn-sm","btn-secondary",3,"click"],["aria-hidden","true",1,"fa","fa-bars"],[1,"text-center"],["class","dropdown waves-light","dropdown","","role","menu",4,"ngIf"],["dropdown","","role","menu",1,"dropdown","waves-light"],["dropdownToggle","","mdbWavesEffect","",1,"waves-light",2,"width","100%"],["aria-hidden","true",1,"fa","fa-ellipsis-v"],[1,"dropdown-menu"],["class","dropdown-item",3,"click",4,"ngIf"],[1,"dropdown-item",3,"click"],[1,"table","table-hover","table-sm"],["scope","col",1,"text-center"],[3,"checked","disabled"],[1,"btn","btn-primary","btn-sm","mr-2",2,"cursor","pointer",3,"click"]],template:function(e,t){1&e&&(b.Yb(0,"div",0),b.Yb(1,"div",1),b.Yb(2,"div",2),b.Yb(3,"div",3),b.Yb(4,"div",4),b.Yb(5,"div",1),b.Kc(6,v,3,0,"div",5),b.Xb(),b.Yb(7,"div",6),b.Yb(8,"div",7),b.Yb(9,"h2"),b.Mc(10),b.lc(11,"titlecase"),b.Yb(12,"small"),b.Mc(13),b.lc(14,"titlecase"),b.Tb(15,"br"),b.Mc(16),b.Xb(),b.Xb(),b.Xb(),b.Yb(17,"div",8),b.Yb(18,"a",9),b.gc("click",(function(){return t.openRequests()})),b.Tb(19,"i",10),b.Mc(20," Requests "),b.Xb(),b.Kc(21,S,3,0,"a",11),b.Kc(22,M,3,0,"a",12),b.Xb(),b.Xb(),b.Yb(23,"div",13),b.Yb(24,"div",14),b.Yb(25,"div",15),b.gc("click",(function(){return t.openRequests("1")})),b.Yb(26,"div",16),b.Tb(27,"i",10),b.Xb(),b.Yb(28,"div",17),b.Mc(29),b.Xb(),b.Yb(30,"h3"),b.Mc(31,"New Droppings"),b.Xb(),b.Yb(32,"p"),b.Mc(33,"Pending Acceptance"),b.Xb(),b.Xb(),b.Xb(),b.Yb(34,"div",14),b.Yb(35,"div",15),b.gc("click",(function(){return t.openRequests("2")})),b.Yb(36,"div",17),b.Mc(37),b.Xb(),b.Yb(38,"h3"),b.Mc(39,"Stored Items"),b.Xb(),b.Yb(40,"p"),b.Mc(41,"Items in store without pick requests"),b.Xb(),b.Xb(),b.Xb(),b.Yb(42,"div",14),b.Yb(43,"div",15),b.gc("click",(function(){return t.openRequests("3")})),b.Yb(44,"div",17),b.Yb(45,"small"),b.Mc(46),b.Xb(),b.Xb(),b.Yb(47,"h3"),b.Mc(48,"Pick Requests"),b.Xb(),b.Yb(49,"p"),b.Mc(50,"Items With pick Requests."),b.Xb(),b.Xb(),b.Xb(),b.Yb(51,"div",14),b.Yb(52,"div",18),b.Yb(53,"div",17),b.Yb(54,"small"),b.Mc(55),b.Xb(),b.Xb(),b.Yb(56,"h3"),b.Mc(57,"Today Earnings"),b.Xb(),b.Yb(58,"p"),b.Mc(59),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Yb(60,"div",1),b.Yb(61,"div",19),b.Yb(62,"div",20),b.Yb(63,"div",21),b.Yb(64,"div",1),b.Yb(65,"div",7),b.Yb(66,"h2"),b.Mc(67,"Drop Summary "),b.Yb(68,"small"),b.Mc(69,"Weekly progress"),b.Xb(),b.Xb(),b.Xb(),b.Yb(70,"div",22),b.Yb(71,"form",23),b.Yb(72,"div",24),b.Tb(73,"mdb-date-picker",25),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Yb(74,"div",26),b.Yb(75,"div",27),b.Yb(76,"div"),b.Yb(77,"div",28),b.Yb(78,"canvas",29,30),b.gc("chartHover",(function(e){return t.chartHovered(e)}))("chartClick",(function(e){return t.chartClicked(e)})),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Yb(80,"div",31),b.Yb(81,"div",1),b.Yb(82,"div",32),b.Yb(83,"div",33),b.Yb(84,"div",4),b.Yb(85,"h4"),b.Mc(86,"Weekly Earnings"),b.Xb(),b.Yb(87,"h2"),b.Mc(88),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Yb(89,"div",32),b.Yb(90,"div",33),b.Yb(91,"div",4),b.Yb(92,"h4"),b.Mc(93,"Weekly Accepted Items"),b.Xb(),b.Yb(94,"h2"),b.Mc(95),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Yb(96,"div",32),b.Yb(97,"div",33),b.Yb(98,"div",4),b.Yb(99,"h4"),b.Mc(100,"Weekly Released Items"),b.Xb(),b.Yb(101,"h2"),b.Mc(102),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Yb(103,"div",32),b.Yb(104,"div",33),b.Yb(105,"div",4),b.Yb(106,"h4"),b.Mc(107,"Weekly Unpicked Items"),b.Xb(),b.Yb(108,"h2"),b.Mc(109),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Yb(110,"div",1),b.Yb(111,"div",19),b.Yb(112,"div",20),b.Yb(113,"h2"),b.Mc(114,"Recent "),b.Yb(115,"small"),b.Mc(116,"Drop Requests"),b.Xb(),b.Xb(),b.Yb(117,"div",26),b.Yb(118,"div",34),b.Yb(119,"div",35),b.Yb(120,"table",36),b.Yb(121,"caption"),b.Mc(122,"List of Drop Requests"),b.Xb(),b.Yb(123,"thead"),b.Yb(124,"tr"),b.Yb(125,"th",37),b.Mc(126,"#"),b.Xb(),b.Yb(127,"th",37),b.Mc(128,"Name"),b.Xb(),b.Yb(129,"th",37),b.Mc(130,"Description"),b.Xb(),b.Yb(131,"th",37),b.Mc(132,"Type"),b.Xb(),b.Yb(133,"th",37),b.Mc(134,"Hours"),b.Xb(),b.Yb(135,"th",37),b.Mc(136,"Cost"),b.Xb(),b.Yb(137,"th",37),b.Mc(138,"Paid"),b.Xb(),b.Yb(139,"th",37),b.Mc(140,"Balance"),b.Xb(),b.Yb(141,"th",37),b.Mc(142,"Status"),b.Xb(),b.Yb(143,"th",37),b.Mc(144,"Action"),b.Xb(),b.Xb(),b.Xb(),b.Yb(145,"tbody"),b.Kc(146,w,21,10,"tr",38),b.Xb(),b.Xb(),b.Yb(147,"a",39),b.gc("click",(function(){return t.openRequests()})),b.Mc(148,"View All"),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Kc(149,I,31,1,"div",40),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb()),2&e&&(b.Db(6),b.qc("ngIf",t.loading),b.Db(4),b.Oc("",b.mc(11,26,null==t.shop?null:t.shop.shop_name)," - "),b.Db(3),b.Oc("",b.mc(14,28,(null==t.shop?null:t.shop.shop_location)+"")," "),b.Db(3),b.Oc(" ",null==t.shop?null:t.shop.phone_number,""),b.Db(5),b.qc("ngIf",t.hasShopAdminRole),b.Db(1),b.qc("ngIf",t.hasShopAdminRole),b.Db(7),b.Nc(t.dropShopStats.new_dropping),b.Db(8),b.Nc(t.dropShopStats.stored_items),b.Db(9),b.Nc(t.dropShopStats.release_requests),b.Db(9),b.Oc("KSH. ",t.dropShopStats.shop_earning,""),b.Db(4),b.Nc(t.today.getFullYear()+"-"+(t.today.getMonth()+1)+"-"+t.today.getDate()),b.Db(12),b.qc("formGroup",t.dateFilterForm),b.Db(2),b.qc("inline",!0)("options",t.pickDateOptions),b.Db(5),b.qc("chartType",t.chartType)("datasets",t.chartDatasets)("labels",t.chartLabels)("colors",t.chartColors)("options",t.chartOptions)("legend",!0),b.Db(10),b.Oc("Ksh. ",t.dropShopStats.Weekly_shop_earning,""),b.Db(7),b.Nc(t.dropShopStats.weekly_accepted_items),b.Db(7),b.Nc(t.dropShopStats.weekly_release_requests),b.Db(7),b.Nc(t.dropShopStats.weekly_unpicked_requests),b.Db(37),b.qc("ngForOf",t.itemList),b.Db(3),b.qc("ngIf",t.hasShopAdminRole))},directives:[o.j,r.w,r.M,i.u,i.l,i.f,r.s,i.k,i.e,r.c,o.i,r.d,r.e,r.i],pipes:[o.p],styles:[".dropdown-content[_ngcontent-%COMP%]{right:0!important;left:0!important}.dropdown[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%], .dropleft[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%], .dropright[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%], .dropup-material[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]{padding:3px}.dropdown-menu[_ngcontent-%COMP%]{margin-top:0;min-width:4.5rem}.md-form[_ngcontent-%COMP%]{margin-top:0}.datepicker-inline-icon[_ngcontent-%COMP%]{top:0}.card-body[_ngcontent-%COMP%]{padding-top:.25rem;padding-bottom:.25rem}.fixed-top-2[_ngcontent-%COMP%]{margin-top:60px;margin-left:230px!important}"]}),e})();var L=s("pSwl"),F=s("QR1q");function q(e,t){1&e&&(b.Yb(0,"mdb-error"),b.Mc(1,"Enter a name/phone to search"),b.Xb())}function E(e,t){1&e&&(b.Yb(0,"div",24),b.Yb(1,"div",25),b.Tb(2,"div",26),b.Xb(),b.Xb())}function P(e,t){if(1&e){const e=b.Zb();b.Yb(0,"tr"),b.Yb(1,"td"),b.Mc(2),b.Xb(),b.Yb(3,"td"),b.Mc(4),b.Xb(),b.Yb(5,"td"),b.Mc(6),b.Xb(),b.Yb(7,"td"),b.Mc(8),b.Xb(),b.Yb(9,"td"),b.Tb(10,"mdb-checkbox",27),b.Xb(),b.Yb(11,"td",28),b.Yb(12,"button",29),b.gc("click",(function(){b.Ec(e);const s=t.$implicit;return b.kc().viewUser(s)})),b.Mc(13,"View"),b.Xb(),b.Xb(),b.Xb()}if(2&e){const e=t.$implicit,s=t.index,o=b.kc();b.Db(2),b.Oc("",o.itemNumber(s),"."),b.Db(2),b.Nc(e.first_name+" "+e.last_name),b.Db(2),b.Nc(e.email_address),b.Db(2),b.Nc(e.phone_number),b.Db(2),b.qc("checked",e.enabled)("disabled",!0)}}let x=(()=>{class e{constructor(e,t,s,o,i,r){this._formBuilder=e,this._route=t,this._router=s,this._modalService=o,this._shopService=i,this._userService=r,this.page=new c.a,this.MAX_SIZE=3,this.shop=new g,this.userList=[],this.first_name="Joel00"}ngOnInit(){this.shopNumber=this._route.snapshot.paramMap.get("id"),console.log("SHOP NUMBER :: "+this.shopNumber),this.searchForm=this._formBuilder.group({search_value:["",i.s.compose([i.s.required])]}),this.searchForm.get("search_value").valueChanges.pipe().subscribe(e=>{this.page.pageNumber=0,this.page_changed=!1,this.searchForm.valid&&null!=e&&null!=e&&""!=e?(this.loading=!0,this.searchValue=e,this.searchField=Object(Y.e)(this.searchValue).validPhone?"phone_number":"name",this.getUsers()):(this.searchField=null,this.searchValue=null,this.getUsers())}),null==this.shopNumber||null==this.shopNumber?this._router.navigate(["/drop/shops"]):this.getShopDetails(),this._modalService.closed.subscribe(()=>this.getShopDetails())}isTouched(e){return this.searchForm.controls[e].touched}isInValid(e,t){return this.searchForm.controls[e].hasError(t)}get isInvalidSearchValue(){return this.isInValid("search_value","required")&&this.isTouched("search_value")}getShopDetails(){this.loading=!0,this._shopService.getShops(this.page.pageNumber.toString(),"1",null,null,null,this.shopNumber).subscribe(e=>{console.log(e),this.shop=e.data[0],console.log(this.shop),this.getUsers()},e=>{this.loading=!1})}getUsers(){this.loading=!0,this.userList=[],this._userService.getUsers(this.page.pageNumber.toString(),this.page.size.toString(),null,this.shop.id.toString(),this.shopNumber,null,null,null,null,this.searchField,this.searchValue).subscribe(e=>{console.log(e),this.userList=e.data,console.log(this.userList),this.loading=!1},e=>{this.loading=!1})}itemNumber(e){return this.page_changed?(this.page.pageNumber-1)*this.page.size+e+1:e+1}pageChanged(e){console.log("EV PAGE :: "+e.page),console.log("PAGE NO :: "+this.page.pageNumber),this.page.pageNumber=e.page,console.log("PAGE NO :: "+this.page.pageNumber),this.page_changed=!0,this.getUsers()}viewUser(e){console.log(e),console.log(e.user_number),this._router.navigate([e.user_number],{relativeTo:this._route})}openUserModal(){this.modalRef=this._modalService.show(F.a,{backdrop:!0,ignoreBackdropClick:!0,class:"modal-lg",data:{isEdit:!1,userShop:this.shop}})}}return e.\u0275fac=function(t){return new(t||e)(b.Sb(i.c),b.Sb(a.a),b.Sb(a.e),b.Sb(r.u),b.Sb(h.a),b.Sb(l.a))},e.\u0275cmp=b.Mb({type:e,selectors:[["app-users"]],decls:55,vars:14,consts:[[1,"drop_content"],[1,"row"],[1,"col-md-12","mb-4",2,"padding-top","5px"],[1,"card"],[1,"card-body","border-top"],[1,"row","mb-2"],[1,"col-md-4","mt-2"],[1,"col-md-4","offset-md-4"],[3,"formGroup"],[1,"md-form","text-center","mr-2","pr-1"],["id","search_value","type","text","mdbInput","","mdbValidate","","formControlName","search_value",1,"form-control"],["for","search_value"],[4,"ngIf"],["class","col-md-12 col-lg-12 col-sm-6 overlay",4,"ngIf"],[1,"col-md-12","col-lg-12","col-sm-6"],[1,"float-right","btn","btn-primary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-user-plus"],[1,"col-md-12","com-sm-12","col-xs-12"],[1,"table-responsive"],[1,"table","table-hover","table-sm"],["scope","col"],["scope","col",1,"text-center"],[4,"ngFor","ngForOf"],[1,"float-left","drop_table_pagenation",3,"maxSize","totalItems","ngModel","itemsPerPage","ngModelChange","pageChanged"],[1,"col-md-12","col-lg-12","col-sm-6","overlay"],[1,"spinner-wrapper"],[1,"spinner"],[3,"checked","disabled"],[1,"text-center"],[1,"btn","btn-primary","btn-sm","mr-2",2,"cursor","pointer",3,"click"]],template:function(e,t){1&e&&(b.Yb(0,"div",0),b.Yb(1,"div",1),b.Yb(2,"div",2),b.Yb(3,"div",3),b.Yb(4,"div",4),b.Yb(5,"div",5),b.Yb(6,"div",6),b.Yb(7,"h2"),b.Mc(8),b.lc(9,"titlecase"),b.Yb(10,"small"),b.Mc(11,"Shop Operators"),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Yb(12,"div",5),b.Yb(13,"div",6),b.Yb(14,"h2"),b.Mc(15),b.lc(16,"titlecase"),b.Yb(17,"small"),b.Mc(18,"Shop Operators"),b.Xb(),b.Xb(),b.Xb(),b.Yb(19,"div",7),b.Yb(20,"form",8),b.Yb(21,"div",9),b.Tb(22,"input",10),b.Yb(23,"label",11),b.Mc(24,"Search by name/phone"),b.Xb(),b.Kc(25,q,2,0,"mdb-error",12),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Yb(26,"div",1),b.Kc(27,E,3,0,"div",13),b.Yb(28,"div",14),b.Yb(29,"span",15),b.gc("click",(function(){return t.openUserModal()})),b.Tb(30,"i",16),b.Mc(31,"Add User"),b.Xb(),b.Xb(),b.Xb(),b.Yb(32,"div",1),b.Yb(33,"div",17),b.Yb(34,"div",18),b.Yb(35,"table",19),b.Yb(36,"caption"),b.Mc(37,"List of Shop Operators"),b.Xb(),b.Yb(38,"thead"),b.Yb(39,"tr"),b.Yb(40,"th",20),b.Mc(41,"#"),b.Xb(),b.Yb(42,"th",20),b.Mc(43,"Name"),b.Xb(),b.Yb(44,"th",20),b.Mc(45,"Email"),b.Xb(),b.Yb(46,"th",20),b.Mc(47,"Phone"),b.Xb(),b.Yb(48,"th",20),b.Mc(49,"Active"),b.Xb(),b.Yb(50,"th",21),b.Mc(51,"Action"),b.Xb(),b.Xb(),b.Xb(),b.Yb(52,"tbody"),b.Kc(53,P,14,6,"tr",22),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Yb(54,"pagination",23),b.gc("ngModelChange",(function(e){return t.page.pageNumber=e}))("pageChanged",(function(e){return t.pageChanged(e)})),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb()),2&e&&(b.Db(8),b.Oc("",b.mc(9,10,t.first_name)," - "),b.Db(7),b.Oc("",b.mc(16,12,t.shop.shop_name)," - "),b.Db(5),b.qc("formGroup",t.searchForm),b.Db(5),b.qc("ngIf",t.isInvalidSearchValue),b.Db(2),b.qc("ngIf",t.loading),b.Db(26),b.qc("ngForOf",t.userList),b.Db(1),b.qc("maxSize",t.MAX_SIZE)("totalItems",t.page.totalElements)("ngModel",t.page.pageNumber)("itemsPerPage",t.page.size))},directives:[i.u,i.l,i.f,i.b,r.C,r.G,i.k,i.e,o.j,o.i,n.a,i.m,r.A,r.i],pipes:[o.p],styles:[".card-body[_ngcontent-%COMP%]{padding-top:0;padding-right:0}.md-form[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:.75rem}"]}),e})();var A=s("jZhJ"),U=s("5vxX");function R(e,t){1&e&&(b.Yb(0,"div",16),b.Yb(1,"div",17),b.Tb(2,"div",18),b.Xb(),b.Xb())}function T(e,t){if(1&e){const e=b.Zb();b.Yb(0,"span",19),b.gc("click",(function(){return b.Ec(e),b.kc().openEditUserModal()})),b.Mc(1,"Edit User"),b.Xb()}}function V(e,t){if(1&e){const e=b.Zb();b.Yb(0,"span",19),b.gc("click",(function(){return b.Ec(e),b.kc().resetPassword()})),b.Mc(1,"Reset Password"),b.Xb()}}function B(e,t){1&e&&(b.Yb(0,"span",20),b.Mc(1," Active"),b.Xb())}function K(e,t){1&e&&(b.Yb(0,"span",21),b.Mc(1,"Not Active"),b.Xb())}function z(e,t){if(1&e&&(b.Yb(0,"span",20),b.Mc(1),b.Xb()),2&e){const e=b.kc().$implicit;b.Db(1),b.Nc(e.shop_name)}}function Z(e,t){if(1&e&&(b.Yb(0,"div",22),b.Yb(1,"div",23),b.Yb(2,"div",24),b.Yb(3,"h5",25),b.Mc(4),b.Xb(),b.Yb(5,"p",26),b.Mc(6),b.Xb(),b.Kc(7,z,2,1,"span",11),b.Xb(),b.Xb(),b.Xb()),2&e){const e=t.$implicit;b.Db(4),b.Nc(e.name),b.Db(2),b.Nc(e.description),b.Db(1),b.qc("ngIf",null==e?null:e.shop_name)}}let j=(()=>{class e{constructor(e,t,s,o,i){this._formBuilder=e,this._route=t,this._router=s,this._modalService=o,this._userService=i,this.page=new c.a,this.user=new A.a,this.shop=null,this.roleList=[]}ngOnInit(){this.userNumber=this._route.snapshot.paramMap.get("user_id"),this.shopNumber=this._route.snapshot.paramMap.get("id");let e=window.location.pathname.split("/").pop();this.userInfoForm=this._formBuilder.group({first_name:"",last_name:"",other_name:"",active_user:"",phone_number:"",email_address:""}),"profile"==e?(this.isUserProfile=!0,this.user=this._userService.getAuthenticatedUser(),this.roleList=[],this.user.roles.forEach(e=>{null!=e.shop_id&&null!=e.shop_id||(this.roleList.push({id:e.id,name:e.name,description:e.description}),this.roleList.slice())}),console.log(this.user.shops),this.user.shops.forEach(e=>{console.log("SHOP ID : "+e.id),this.user.roles.forEach(t=>{console.log("ROLE SHOP ID : "+t.shop_id),e.id==t.shop_id&&(this.roleList.push({id:t.id,name:t.name,description:t.description,shop_name:e.shop_name}),this.roleList.slice())})})):null==this.userNumber||null==this.userNumber?this._router.navigate(["/drop/shops"]):(this.getUserDetails(),this._modalService.closed.subscribe(()=>this.getUserDetails()))}getUserDetails(){this.roleList=[],this.loading=!0,this._userService.getUsers(this.page.pageNumber.toString(),"1",null,null,null,null,null,null,this.userNumber).subscribe(e=>{console.log(e),this.user=e.data[0],console.log(this.user),this.shop=Object(Y.h)(this.user.shops,this.shopNumber),this.hasShopAdminRole=Object(Y.i)(this.user.roles,3,this.shop.id),console.log(this.user.shops),null!=this.shopNumber&&null!=this.shopNumber&&this.user.shops.forEach(e=>{e.shop_number==this.shopNumber&&(this.shop=e)}),this.user.roles.forEach(e=>{e.shop_id==this.shop.id&&(this.roleList.push({id:e.id,name:e.name,description:e.description}),this.roleList.slice())}),this.loading=!1},e=>{this.loading=!1})}openEditUserModal(){this.modalRef=this._modalService.show(F.a,{backdrop:!0,ignoreBackdropClick:!0,class:"modal-lg",data:{isEdit:!0,user:this.user,userShop:this.shop}})}resetPassword(){this.modalRef=this._modalService.show(U.a,{backdrop:!0,ignoreBackdropClick:!0,class:"modal-md",data:{}})}}return e.\u0275fac=function(t){return new(t||e)(b.Sb(i.c),b.Sb(a.a),b.Sb(a.e),b.Sb(r.u),b.Sb(l.a))},e.\u0275cmp=b.Mb({type:e,selectors:[["app-user"]],decls:42,vars:14,consts:[[1,"drop_content"],[1,"row"],[1,"col-md-12","mb-4",2,"padding-top","5px"],["class","col-md-12 col-lg-12 col-sm-6 overlay",4,"ngIf"],[1,"col-md-12","com-sm-12","col-xs-12"],[1,"nvb-bg","app-text-color"],[1,"mb-3"],["class","float-right btn btn-primary btn-sm",3,"click",4,"ngIf"],[1,"px-lg-5"],[1,"col-sm-6","col-md-4"],[1,"app-text-color","mb-1","section-edit-title"],["class","mr-2 badge badge-success",4,"ngIf"],["class","mr-2 badge badge-danger",4,"ngIf"],[1,"section-title","mb-3"],[1,"row","mb-3"],["class","col-sm-12 col-md-4 col-lg-4 col-xl-3 mb-3",4,"ngFor","ngForOf"],[1,"col-md-12","col-lg-12","col-sm-6","overlay"],[1,"spinner-wrapper"],[1,"spinner"],[1,"float-right","btn","btn-primary","btn-sm",3,"click"],[1,"mr-2","badge","badge-success"],[1,"mr-2","badge","badge-danger"],[1,"col-sm-12","col-md-4","col-lg-4","col-xl-3","mb-3"],[1,"card"],[1,"card-body"],[1,"card-title","mb-1"],[1,"card-text","role-description"]],template:function(e,t){1&e&&(b.Yb(0,"div",0),b.Yb(1,"div",1),b.Yb(2,"div",2),b.Yb(3,"div",1),b.Kc(4,R,3,0,"div",3),b.Xb(),b.Yb(5,"div",1),b.Yb(6,"div",4),b.Yb(7,"mdb-card"),b.Yb(8,"mdb-card-header",5),b.Yb(9,"h2",6),b.Mc(10,"User Information "),b.Kc(11,T,2,0,"span",7),b.Kc(12,V,2,0,"span",7),b.Xb(),b.Xb(),b.Yb(13,"mdb-card-body",8),b.Yb(14,"div",1),b.Yb(15,"div",9),b.Yb(16,"p",10),b.Mc(17,"Names"),b.Xb(),b.Yb(18,"h2"),b.Mc(19),b.lc(20,"titlecase"),b.lc(21,"titlecase"),b.Xb(),b.Xb(),b.Yb(22,"div",9),b.Yb(23,"p",10),b.Mc(24,"Email"),b.Xb(),b.Yb(25,"h2"),b.Mc(26),b.Xb(),b.Xb(),b.Yb(27,"div",9),b.Yb(28,"p",10),b.Mc(29,"Phone Number"),b.Xb(),b.Yb(30,"h2"),b.Mc(31),b.Xb(),b.Xb(),b.Yb(32,"div",9),b.Yb(33,"p",10),b.Mc(34,"Status"),b.Xb(),b.Yb(35,"span"),b.Kc(36,B,2,0,"span",11),b.Kc(37,K,2,0,"span",12),b.Xb(),b.Xb(),b.Xb(),b.Yb(38,"h2",13),b.Mc(39,"User Roles"),b.Xb(),b.Yb(40,"div",14),b.Kc(41,Z,8,3,"div",15),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb()),2&e&&(b.Db(4),b.qc("ngIf",t.loading),b.Db(7),b.qc("ngIf",t.hasShopAdminRole),b.Db(1),b.qc("ngIf",t.isUserProfile),b.Db(7),b.Pc("",b.mc(20,10,null==t.user?null:t.user.first_name)," ",b.mc(21,12,null==t.user?null:t.user.last_name),""),b.Db(7),b.Nc(null==t.user?null:t.user.email_address),b.Db(5),b.Nc(null==t.user?null:t.user.phone_number),b.Db(5),b.qc("ngIf",1==(null==t.user?null:t.user.enabled)),b.Db(1),b.qc("ngIf",0==(null==t.user?null:t.user.enabled)),b.Db(4),b.qc("ngForOf",t.roleList))},directives:[o.j,r.y,r.z,r.x,o.i],pipes:[o.p],styles:[""]}),e})();var W=s("pxUr"),G=s("5eHb"),H=s("GBiA");const $=["search"];function J(e,t){1&e&&(b.Yb(0,"div",27),b.Yb(1,"div",28),b.Tb(2,"div",29),b.Xb(),b.Xb())}function Q(e,t){if(1&e){const e=b.Zb();b.Yb(0,"span",30),b.gc("click",(function(){return b.Ec(e),b.kc().postShop()})),b.Mc(1),b.Xb()}if(2&e){const e=b.kc();b.Db(1),b.Nc(e.buttonActionLabel)}}const ee=function(e){return{hidden:e}};let te=(()=>{class e{constructor(e,t,s,o,i,r,n,a,b,l){this._formBuilder=e,this._mapsAPILoader=t,this._ngZone=s,this._route=o,this._router=i,this._location=r,this._shopService=n,this._toastr=a,this._userService=b,this._openShopService=l,this.page=new c.a,this.pageAction="Shop Information",this.buttonActionLabel="Save",this.zoom=15}ngOnInit(){this.shopNumber=this._route.snapshot.paramMap.get("id"),this.pathName=window.location.pathname.split("/").pop(),this.user=this._userService.getAuthenticatedUser(),this.shopForm=this._formBuilder.group({shop_name:["",i.s.compose([i.s.required,Y.b])],phone_number:["",i.s.compose([i.s.required,Y.b])],shop_location:["",i.s.compose([i.s.required,Y.b])],open_status:[""],search_control:[""]}),null==this.shopNumber&&null==this.shopNumber||(this.shop=Object(Y.h)(this.user.shops,this.shopNumber),null!=this.shop?(this.hasShopAdminRole=!(!Object(Y.i)(this.user.roles,3,this.shop.id)&&this.shop.user_id!=this.user.id),this.currentLat=this.shop.latitude,this.currentLong=this.shop.longitude,this.shopMarker={lat:this.currentLat,lng:this.currentLong,draggable:!0,clickable:!1,label:"Current shop location(Drag to Change)",animation:"BOUNCE",title:this.shop.shop_name.toUpperCase()+" - "+this.shop.shop_location},this.buttonActionLabel="Save Changes",this.setShopFormValues()):(this.getShopDetails(),this.buttonActionLabel="Save Changes")),this.canEdit=!("add"!=this.pathName&&!this.hasShopAdminRole),this._mapsAPILoader.load().then(()=>{"new"==this.action&&this.setCurrentLocation();let e=new google.maps.places.Autocomplete(this.searchElementRef.nativeElement);e.addListener("place_changed",()=>{this._ngZone.run(()=>{let t=e.getPlace();null!=t.geometry&&(this.currentLat=t.geometry.location.lat(),this.currentLong=t.geometry.location.lng(),this.shopMarker={lat:this.currentLat,lng:this.currentLong,draggable:!0,clickable:!1,label:"Current shop location(Drag to Change)",animation:"BOUNCE",title:"Your Shop is located at "+t.name})})})})}getShopDetails(){this.loading=!0,this._userService.getUsers(this.page.pageNumber.toString(),"1",this.user.id.toString(),null,this.shopNumber,null,null,null).subscribe(e=>{this.user=e.data[0],this.shop=Object(Y.h)(this.user.shops,this.shopNumber),this.hasShopAdminRole=!(!Object(Y.i)(this.user.roles,3,this.shop.id)&&this.shop.user_id!=this.user.id),this.setShopFormValues(),this.currentLat=this.shop.latitude,this.currentLong=this.shop.longitude,this.shopMarker={lat:this.currentLat,lng:this.currentLong,draggable:!0,clickable:!1,label:"Current shop location(Drag to Change)",animation:"BOUNCE",title:this.shop.shop_name.toUpperCase()+" - "+this.shop.shop_location},this.setShopFormValues(),this.loading=!1},e=>{this.loading=!1})}setShopFormValues(){this.canEdit=!("add"!=this.pathName&&!this.hasShopAdminRole),this.pageAction="add"==this.pathName?"Add New Shop":this.pageAction,null!=this.shop&&(this.shopForm.get("shop_name").setValue(this.shop.shop_name),this.shopForm.get("phone_number").setValue(this.shop.phone_number),this.shopForm.get("shop_location").setValue(this.shop.shop_location),this.shopForm.get("open_status").setValue(this.shop.is_open),this.enableDisableFormFields())}enableDisableFormFields(){this.canEdit?(this.shopForm.get("shop_name").enable(),this.shopForm.get("phone_number").enable(),this.shopForm.get("shop_location").enable(),this.shopForm.get("open_status").enable(),this.shopForm.get("search_control").enable()):(this.shopForm.get("shop_name").disable(),this.shopForm.get("phone_number").disable(),this.shopForm.get("shop_location").disable(),this.shopForm.get("open_status").disable(),this.shopForm.get("search_control").disable())}setCurrentLocation(){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(e=>{this.currentLat=e.coords.latitude,this.currentLong=e.coords.longitude,this.shopMarker={lat:this.currentLat,lng:this.currentLong,draggable:!0,clickable:!1,label:"Drag the Red marker to where your shop is located.",animation:"BOUNCE",title:"My Position"}},e=>{this._toastr.error("Unable to access your current location")}):alert("Geolocation not supported!!")}mapReady(e){this.map=e,this.map.controls[google.maps.ControlPosition.TOP_CENTER].push(document.getElementById("search-control"))}markerDragEnd(e,t){this.currentLat=t.coords.lat,this.currentLong=t.coords.lng,this.shopMarker={lat:this.currentLat,lng:this.currentLong,draggable:!0,clickable:!1,label:"Drag the Red marker to where your shop is located.",animation:"BOUNCE",title:"Customers will see your shop here"}}postShop(){let e={is_open:this.shopForm.get("open_status").value,phone_number:this.shopForm.get("phone_number").value,shop_name:this.shopForm.get("shop_name").value,shop_location:this.shopForm.get("shop_location").value,latitude:this.shopMarker.lat,longitude:this.shopMarker.lng};console.log(e),"add"==this.pathName?this._shopService.createShop(e).subscribe(e=>{let t=e.data;this._openShopService.addStore(t.id.toString(),t.shop_name,t.latitude,t.longitude),this._toastr.success("Shop added successful","SUCCESSFULL"),this.shopForm.reset(),this.setCurrentLocation(),this._location.back()},e=>{console.log(e),400==e.status&&this._toastr.error("Invalid Request Parameters not permitted"),409==e.status&&this._toastr.error(e.error.api_code_description),console.log(e)}):this._shopService.updateShop(this.shop.id.toString(),e).subscribe(e=>{let t=e.data;this._openShopService.addStore(t.id.toString(),t.shop_name,t.latitude,t.longitude),this._toastr.success("Shop Details updated successful","SUCCESSFULL"),this.shopForm.reset(),this.setCurrentLocation(),this._location.back()},e=>{console.log(e),400==e.status&&this._toastr.error("Invalid Request Parameters not permitted"),console.log(e)})}}return e.\u0275fac=function(t){return new(t||e)(b.Sb(i.c),b.Sb(W.f),b.Sb(b.A),b.Sb(a.a),b.Sb(a.e),b.Sb(o.f),b.Sb(h.a),b.Sb(G.b),b.Sb(l.a),b.Sb(H.a))},e.\u0275cmp=b.Mb({type:e,selectors:[["app-shop-profile"]],viewQuery:function(e,t){var s;1&e&&b.Sc($,!0),2&e&&b.Ac(s=b.hc())&&(t.searchElementRef=s.first)},decls:48,vars:24,consts:[[1,"drop_content"],[1,"row"],[1,"col-md-12","mb-4",2,"padding-top","5px"],["class","col-md-12 col-lg-12 col-sm-6 overlay",4,"ngIf"],[1,"col-md-12","com-sm-12","col-xs-12"],[1,"nvb-bg","app-text-color"],[1,"mb-3"],["class","float-right btn btn-primary btn-sm",3,"click",4,"ngIf"],[1,"px-lg-5"],[3,"formGroup"],[1,"col-sm-6","col-md-4"],[1,"md-form"],["id","shop_name","type","text","mdbInput","","mdbValidate","","formControlName","shop_name",1,"form-control",2,"text-transform","capitalize"],["for","shop_name"],["id","phone_number","type","text","mdbInput","","mdbValidate","","formControlName","phone_number",1,"form-control",2,"text-transform","capitalize"],["id","shop_location","type","text","mdbInput","","mdbValidate","","formControlName","shop_location",1,"form-control",2,"text-transform","capitalize"],["for","shop_location"],[1,"col-sm-2"],["formControlName","open_status",3,"checked","click"],[1,"section-title","mb-1"],[1,"row","mb-3"],["id","map"],[3,"latitude","longitude","zoom","minZoom","maxZoom","fullscreenControl","fullscreenControlOptions","streetViewControl","mapReady"],["id","search-control",1,"form-group","w-75","controls","mt-1"],["type","text","formControlName","search_control","placeholder","Search location by name, or building or road where your shop is located","autocorrect","off","autocapitalize","off","spellcheck","off",1,"form-control",3,"ngClass","key.enter"],["search",""],[3,"markerClickable","latitude","longitude","label","markerDraggable","iconUrl","animation","dragEnd"],[1,"col-md-12","col-lg-12","col-sm-6","overlay"],[1,"spinner-wrapper"],[1,"spinner"],[1,"float-right","btn","btn-primary","btn-sm",3,"click"]],template:function(e,t){1&e&&(b.Yb(0,"div",0),b.Yb(1,"div",1),b.Yb(2,"div",2),b.Yb(3,"div",1),b.Kc(4,J,3,0,"div",3),b.Xb(),b.Yb(5,"div",1),b.Yb(6,"div",4),b.Yb(7,"mdb-card"),b.Yb(8,"mdb-card-header",5),b.Yb(9,"h2",6),b.Mc(10),b.Kc(11,Q,2,1,"span",7),b.Xb(),b.Xb(),b.Yb(12,"mdb-card-body",8),b.Yb(13,"form",9),b.Yb(14,"div",1),b.Yb(15,"div",10),b.Yb(16,"div",11),b.Tb(17,"input",12),b.Yb(18,"label",13),b.Mc(19,"Shop Name"),b.Xb(),b.Xb(),b.Xb(),b.Yb(20,"div",10),b.Yb(21,"div",11),b.Tb(22,"input",14),b.Yb(23,"label",13),b.Mc(24,"Phone Number"),b.Xb(),b.Xb(),b.Xb(),b.Yb(25,"div",10),b.Yb(26,"div",11),b.Tb(27,"input",15),b.Yb(28,"label",16),b.Mc(29,"Physical Location"),b.Xb(),b.Xb(),b.Xb(),b.Yb(30,"div",10),b.Yb(31,"div",17),b.Yb(32,"label"),b.Mc(33,"Open"),b.Xb(),b.Xb(),b.Yb(34,"mdb-checkbox",18),b.gc("click",(function(e){return e.stopPropagation()})),b.Xb(),b.Xb(),b.Xb(),b.Yb(35,"h2",19),b.Mc(36,"Location on Map"),b.Xb(),b.Yb(37,"div",20),b.Yb(38,"div",2),b.Yb(39,"div",21),b.Yb(40,"agm-map",22),b.gc("mapReady",(function(e){return t.mapReady(e)})),b.Yb(41,"div",23),b.Yb(42,"input",24,25),b.gc("key.enter",(function(e){return e.preventDefault()})),b.Xb(),b.Xb(),b.Yb(44,"agm-marker",26),b.gc("dragEnd",(function(e){return t.markerDragEnd(t.shopMarker,e)})),b.Yb(45,"agm-info-window"),b.Yb(46,"strong"),b.Mc(47),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb(),b.Xb()),2&e&&(b.Db(4),b.qc("ngIf",t.loading),b.Db(6),b.Oc("",t.pageAction," "),b.Db(1),b.qc("ngIf",t.canEdit),b.Db(2),b.qc("formGroup",t.shopForm),b.Db(21),b.qc("checked",!1),b.Db(6),b.qc("latitude",t.currentLat)("longitude",t.currentLong)("zoom",t.zoom)("minZoom",7)("maxZoom",20)("fullscreenControl",!0)("fullscreenControlOptions",t.screenOptions)("streetViewControl",!1),b.Db(2),b.qc("ngClass",b.uc(22,ee,t.shopForm.controls.search_control.disabled)),b.Db(2),b.qc("markerClickable",!1)("latitude",null==t.shopMarker?null:t.shopMarker.lat)("longitude",null==t.shopMarker?null:t.shopMarker.lng)("label",null==t.shopMarker?null:t.shopMarker.label)("markerDraggable",null==t.shopMarker?null:t.shopMarker.draggable)("iconUrl",null==t.shopMarker?null:t.shopMarker.icon)("animation",null==t.shopMarker?null:t.shopMarker.animation),b.Db(3),b.Nc(null==t.shopMarker?null:t.shopMarker.title))},directives:[o.j,r.y,r.z,r.x,i.u,i.l,i.f,i.b,r.C,r.G,i.k,i.e,r.i,W.c,o.h,W.d,W.b],styles:["#map[_ngcontent-%COMP%]{width:100%}agm-map[_ngcontent-%COMP%]{height:400px}"]}),e})();const se=[{path:"",component:m},{path:"add",component:te},{path:":id",component:O},{path:":id/items",component:L.a},{path:":id/users",component:x},{path:":id/users/:user_id",component:j},{path:":id/profile",component:te}];let oe=(()=>{class e{}return e.\u0275mod=b.Qb({type:e}),e.\u0275inj=b.Pb({factory:function(t){return new(t||e)},imports:[[a.i.forChild(se)],a.i]}),e})();var ie=s("TXLM");let re=(()=>{class e{}return e.\u0275mod=b.Qb({type:e}),e.\u0275inj=b.Pb({factory:function(t){return new(t||e)},imports:[[o.b,oe,i.g,i.q,r.r.forRoot(),r.h,r.L,r.N,n.b,W.a.forRoot({apiKey:"AIzaSyC_2bjO2wL-sv-Gaq94-j63rHm2Jo8SJB8",libraries:["places"]}),ie.a]]}),e})()}}]);